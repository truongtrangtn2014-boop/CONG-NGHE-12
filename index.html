<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>ỨNG DỤNG AI NHẬN DIỆN LINH KIỆN ĐIỆN TỬ</title>
  <style>
    :root{
      --accent: #0b84ff;
      --card-bg: rgba(255,255,255,0.9);
      --glass: rgba(255,255,255,0.12);
      --max-width-phone: 420px;
    }
    html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial; -webkit-font-smoothing:antialiased}

    /* Background image (chip/linh kiện) subtle & blurred */
    .bg {
      position:fixed;inset:0;z-index:-2;display:block;background-image:url('background-chip.jpg');
      background-size:cover;background-position:center;filter:blur(6px) brightness(0.45);
    }
    /* soft grain overlay to reduce banding */
    .bg::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.08), rgba(0,0,0,0.18));}

    .page{
      min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:18px 12px 28px;box-sizing:border-box;color:#fff;
    }

    header{width:100%;max-width:var(--max-width-phone);margin-top:18px}
    h1{font-size:20px;margin:0;padding:10px 14px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));backdrop-filter:blur(4px);}

    main{width:100%;max-width:var(--max-width-phone);margin-top:14px;display:flex;flex-direction:column;gap:12px}

    /* Camera card */
    .camera-card{
      background:var(--card-bg);color:#000;border-radius:14px;padding:10px;box-shadow:0 6px 18px rgba(2,6,23,0.25);overflow:hidden;
    }

    /* Video container optimized for portrait phones */
    .video-wrap{position:relative;border-radius:10px;overflow:hidden;background:#000;display:flex;align-items:center;justify-content:center}
    video{width:100%;height:auto;max-height:74vh;object-fit:cover;display:block}

    /* Detection overlay (box & label preview) */
    .overlay-box{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:78%;height:42%;border:2px dashed rgba(255,255,255,0.75);border-radius:8px;pointer-events:none;}
    .label-preview{position:absolute;left:8px;top:8px;padding:6px 8px;border-radius:8px;background:rgba(0,0,0,0.55);color:#fff;font-weight:600;font-size:13px}

    /* Controls */
    .controls{display:flex;gap:8px;justify-content:center;padding-top:8px}
    button{appearance:none;border:0;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn-start{background:linear-gradient(90deg,var(--accent),#3ddcff);color:#fff}
    .btn-stop{background:#f1f1f1;color:#111}

    /* Footer italic school name */
    footer{width:100%;max-width:var(--max-width-phone);margin-top:auto;text-align:center;padding:12px 0;color:rgba(255,255,255,0.9)}
    footer em{font-style:italic;font-size:14px;display:inline-block;background:linear-gradient(90deg, rgba(255,255,255,0.06), transparent);padding:6px 12px;border-radius:8px}

    /* Helper text */
    .hint{font-size:13px;color:rgba(0,0,0,0.65);padding:6px 8px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));}

    /* Responsive tweak for larger screens (still portrait layout centered) */
    @media(min-width:700px){
      body{background-color:#0b1220}
      .page{padding:30px}
      h1{font-size:22px}
      .camera-card{max-width:480px;margin:0 auto}
      footer{max-width:480px}
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="page">
    <header>
      <h1>ỨNG DỤNG AI NHẬN DIỆN LINH KIỆN ĐIỆN TỬ</h1>
    </header>

    <main>
      <div class="camera-card" role="region" aria-label="Khu vực camera">
        <div class="video-wrap" id="videoWrap">
          <video id="video" playsinline autoplay muted></video>
          <div class="overlay-box" id="overlayBox" aria-hidden="true"></div>
          <div class="label-preview" id="labelPreview">Chưa nhận diện</div>
        </div>

        <div style="padding-top:10px;display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
          <div style="flex:1">
            <div class="hint">Để nhận diện chính xác, đặt linh kiện ở trong vùng khung.</div>
          </div>
          <div style="flex:0">
            <div class="controls">
              <button id="startBtn" class="btn-start">Bật camera</button>
              <button id="stopBtn" class="btn-stop" disabled>Tắt</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Placeholder for future model info / quiz -->
      <div style="text-align:center;color:#fff;opacity:0.95;margin-top:6px;font-size:13px">Mô-đun nhận diện có thể được tích hợp ở đây (Teachable Machine / TensorFlow.js).</div>
    </main>

    <footer>
      <em>Trường THPT Trần Quốc Tuấn</em>
    </footer>
  </div>

  <script>
    const video = document.getElementById('video');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const labelPreview = document.getElementById('labelPreview');
    let stream = null;

    async function startCamera(){
      // Prefer rear camera (environment). Some browsers may ignore exact facingMode; use ideal.
      const constraints = {
        audio: false,
        video: {
          facingMode: { ideal: 'environment' },
          width: { ideal: 1080 },
          height: { ideal: 1920 }
        }
      };

      try{
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;
        startBtn.disabled = true;
        stopBtn.disabled = false;
        labelPreview.textContent = 'Camera đã bật - sẵn sàng nhận diện';

        // On mobile Safari, ensure video plays
        await video.play().catch(e=>console.warn('video play warning',e));
      }catch(err){
        console.error('Lỗi khi bật camera:', err);
        labelPreview.textContent = 'Không thể truy cập camera. Kiểm tra quyền truy cập.';
        startBtn.disabled = false;
        stopBtn.disabled = true;
      }
    }

    function stopCamera(){
      if(!stream) return;
      // Stop all tracks
      stream.getTracks().forEach(t=>t.stop());
      video.srcObject = null;
      stream = null;
      startBtn.disabled = false;
      stopBtn.disabled = true;
      labelPreview.textContent = 'Camera đã tắt';
    }

    startBtn.addEventListener('click', startCamera);
    stopBtn.addEventListener('click', stopCamera);

    // Clean up when leaving page
    window.addEventListener('pagehide', ()=>{ if(stream) stopCamera(); });

    // Optional: handle orientation advice to user
    function ensurePortrait(){
      // If width > height, suggest rotating device
      if(window.innerWidth > window.innerHeight){
        labelPreview.textContent = 'Xin xoay thiết bị theo chiều dọc để trải nghiệm tốt nhất.';
      }
    }
    window.addEventListener('resize', ensurePortrait);
    ensurePortrait();

    /*
      Ghi chú:
      - Thay file 'background-chip.jpg' bằng hình nền chip/linh kiện mờ của bạn (đặt cùng thư mục).
      - Để tích hợp mô hình nhận diện (Teachable Machine / TensorFlow.js),
        bạn sẽ cần load file model.js / metadata và chạy dự đoán trên khung video.
      - Để ưu tiên camera sau trên một số thiết bị, bạn có thể enumerateDevices() và chọn deviceId tương ứng;
        tuy nhiên giải pháp facingMode: 'environment' đủ cho hầu hết trường hợp.
    */
  </script>
</body>
</html>
