<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ỨNG DỤNG AI NHẬN DIỆN LINH KIỆN ĐIỆN TỬ</title>
  <style>
    :root{
      --accent: #0b63ff;
      --card-bg: rgba(255,255,255,0.92);
      --glass: rgba(255,255,255,0.08);
    }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif;color:#0a0a0a}

    /* Background image (replace chip-bg.jpg with your image) */
    body::before{
      content:"";
      position:fixed;inset:0;background-image:url('chip-bg.jpg');
      background-size:cover;background-position:center;filter:blur(6px) brightness(0.6) contrast(1.05);
      opacity:0.65;z-index:-2;
    }

    /* soft gradient overlay to ensure contrast */
    body::after{
      content:"";position:fixed;inset:0;background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.12));z-index:-1;
    }

    .app{
      min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px;box-sizing:border-box;
    }

    /* Portrait phone frame */
    .phone {
      width:360px;max-width:92vw;height:780px;max-height:92vh;border-radius:28px;box-shadow:0 20px 40px rgba(0,0,0,0.35);overflow:hidden;background:linear-gradient(180deg,#fafafa,#f3f7ff);
      display:flex;flex-direction:column;position:relative;
    }

    header{padding:14px 18px;border-bottom:1px solid rgba(10,10,10,0.04);display:flex;align-items:center;gap:10px}
    header h1{font-size:16px;margin:0;line-height:1.05}
    header p{margin:0;font-size:12px;color:#444}

    .viewer{flex:1;display:flex;align-items:center;justify-content:center;padding:12px}

    /* Video area that keeps portrait orientation */
    .camera-wrap{width:100%;height:100%;max-height:520px;display:flex;align-items:center;justify-content:center;position:relative}
    video{width:100%;height:100%;object-fit:cover;border-radius:12px;background:#000}
    canvas{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none}

    .controls{padding:12px 16px;border-top:1px solid rgba(10,10,10,0.04);display:flex;gap:8px;align-items:center}
    button{flex:1;padding:10px;border-radius:8px;border:0;background:var(--accent);color:#fff;font-weight:600}
    button.stop{background:#d64545}

    .info{padding:12px 16px;font-size:14px}
    .card{background:var(--card-bg);border-radius:12px;padding:10px;box-shadow:0 6px 18px rgba(10,10,10,0.06)}

    .label{font-weight:700;font-size:18px;margin:6px 0}
    .desc{font-size:13px;color:#333;margin:6px 0}

    footer{position:absolute;left:12px;right:12px;bottom:10px;text-align:center;font-size:13px;color:#222}
    footer em{font-style:italic;display:inline-block}

    /* Make layout responsive for smaller phones */
    @media(max-height:700px){.phone{height:92vh}}
    @media(min-width:900px){.phone{width:420px;height:820px}}
  </style>
</head>
<body>
  <div class="app">
    <div class="phone" role="application" aria-label="Ứng dụng AI nhận diện linh kiện">

      <header>
        <div style="flex:1">
          <h1>ỨNG DỤNG AI NHẬN DIỆN LINH KIỆN ĐIỆN TỬ</h1>
          <p>Nhận diện qua camera — mô tả + câu hỏi trắc nghiệm</p>
        </div>
      </header>

      <div class="viewer">
        <div style="width:100%;max-width:420px">
          <div class="camera-wrap card" id="cameraWrap">
            <video id="video" playsinline autoplay muted></video>
            <canvas id="overlay"></canvas>
          </div>

          <div class="info">
            <div class="card">
              <div class="label" id="detectedLabel">Chưa kết nối camera</div>
              <div class="desc" id="detectedDesc">Nhấn "Bật camera" và đưa linh kiện trước camera. Ứng dụng ưu tiên sử dụng camera sau (rear camera).
              </div>
            </div>
          </div>

          <div class="controls">
            <button id="startBtn">Bật camera</button>
            <button id="stopBtn" class="stop">Tắt</button>
          </div>

        </div>
      </div>

      <footer>
        <em>Trường THPT Trần Quốc Tuấn</em>
      </footer>

    </div>
  </div>

  <script>
    const video = document.getElementById('video');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const detectedLabel = document.getElementById('detectedLabel');
    const detectedDesc = document.getElementById('detectedDesc');
    let stream = null;

    // Try to get the rear camera when possible. Use ideal first, fallback to default.
    async function startCamera(){
      detectedLabel.textContent = 'Đang khởi động camera...';
      const constraints = {
        audio:false,
        video: {
          facingMode: { ideal: 'environment' },
          width: { ideal: 1080 },
          height: { ideal: 1920 }
        }
      };

      try{
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;
        await video.play();
        detectedLabel.textContent = 'Camera đã bật — sẵn sàng nhận diện';
        detectedDesc.textContent = 'Đưa linh kiện trước camera sau để nhận diện. (Nếu trình duyệt không hỗ trợ camera sau, sẽ dùng camera mặc định)';
        // Resize canvas to video size
        const canvas = document.getElementById('overlay');
        canvas.width = video.videoWidth || 720;
        canvas.height = video.videoHeight || 1280;

        // Placeholder: here you can call your Teachable Machine predict loop
        // runPredictionLoop();
      }catch(err){
        console.error(err);
        detectedLabel.textContent = 'Không thể mở camera';
        detectedDesc.textContent = 'Hãy kiểm tra quyền truy cập camera và thử lại.';
        alert('Lỗi khi mở camera: ' + (err.message || err));
      }
    }

    function stopCamera(){
      if(stream){
        stream.getTracks().forEach(t => t.stop());
        stream = null;
      }
      video.pause();
      video.srcObject = null;
      detectedLabel.textContent = 'Camera đã tắt';
      detectedDesc.textContent = 'Nhấn "Bật camera" để sử dụng.';
    }

    startBtn.addEventListener('click', ()=> startCamera());
    stopBtn.addEventListener('click', ()=> stopCamera());

    // Optional: keyboard shortcuts for desktop testing
    window.addEventListener('keydown', (e)=>{
      if(e.key === 's') startCamera();
      if(e.key === 'x') stopCamera();
    });

    /*
      HƯỚNG DẪN TÍCH HỢP MÔ HÌNH TEACHABLE MACHINE (tóm tắt):
      - Sau khi export model (TensorFlow.js), chèn script theo hướng dẫn của Teachable Machine
      - Tải model bằng tf.loadGraphModel(modelURL) hoặc tmImage.load(modelURL, metadata)
      - Trong vòng lặp (requestAnimationFrame) lấy frame từ video và dự đoán -> hiển thị kết quả
      - Gợi ý: đặt vùng nhận diện chính giữa video (phù hợp điện thoại dọc)
    */

  </script>
</body>
</html>
